function n(n,t=document){return n instanceof Node?[n]:t.querySelectorAll(n)}function t(n,t=document){return n instanceof Node?n:t.querySelector(n)}function o(){return document.createDocumentFragment()}function c(n){return"SCRIPT"===n.tagName&&"fluor"===n.type}function e(...n){return n.map(n=>Array.isArray(n)?n.map(n=>e(n)).join(" "):"string"==typeof n?n:e(...Object.entries(n).reduce((n,[t,o])=>o?n.concat(t):n,[]))).join(" ")}function r(n,t){return n.split(".").reduce((n,t)=>n[t],t)}function s(n,t,o){return c=n,Boolean(c&&c.constructor&&c.call&&c.apply)?n(t,o):n;var c}const f=window.requestAnimationFrame;async function a(n,t){const o=[n];for(;o.length;){const n=o.shift();if(!1!==await t(n))for(const t of n.children)o.push(t)}}function i(n){let t=n;for(;t;){if(m.t.has(t))return m.t.get(t);t=t.parentElement}return null}function u(n){return Array.isArray(n)?(...t)=>n.forEach(n=>n(...t)):n}async function l(n,t,e){if("TEMPLATE"!==t.tagName)return void 0;if(r(n.value,e)){if(t.o)return t.o.forEach(n=>n.render());const n=o(),e=t.content.cloneNode(!0);t.o=[];for(const o of[...e.children])c(o)||(t.o.push({child:o}),n.append(o));t.parentNode.insertBefore(n,t.nextSibling);for(const n of t.o){const{child:t}=n,o=h(t);n.molecule=o,await g(t),o.render()}}else t.o&&(b(t.o),t.o=null)}async function d(n,t,e){if("TEMPLATE"!==t.tagName)return void 0;const[s,f]=n.value.split(/\s+in\s+/),a=r(f,e),i=o();if(t.s)b(t.s),t.s=null,d(n,t,e);else{t.s=[];for(let n=0,o=a.length;n<o;n++){const o=t.content.cloneNode(!0);for(const e of[...o.children])c(e)||(t.s.push({index:n,child:e}),i.append(e))}t.parentNode.insertBefore(i,t.nextSibling);for(const n of t.s){const{index:t,child:o}=n,c=h(o);c.setup({$index:t,[s]:a[t]}),n.molecule=c,await g(o),c.render()}}}function w(n,t,o){const c=n.name.replace("f-bind-",""),e=r(n.value,o);switch(e){case!0:t.setAttribute(c,"");break;case!1:t.removeAttribute(c);break;default:t.setAttribute(c,e)}}function p(o,c){const p={},h=n=>Object.assign(p,n),y=c?i(c.parentNode):null;async function b(n=!0){const t=i(c);await a(c,async o=>{const c=i(o);if(c!==t)return n&&c.render(n),!1;for(const n of o.attributes)switch(n.name){case"f-text":o.textContent=r(n.value,p);break;case"f-html":o.innerHTML=r(n.value,p);break;case"f-if":await l(n,o,p);break;case"f-each":await d(n,o,p);break;default:n.name.startsWith("f-bind-")&&w(n,o,p)}})}function $(n,t){h("object"==typeof n?Object.entries(n).reduce((n,[t,o])=>({...n,[t]:s(o,p[t],p)}),{}):{[n]:s(t,p[n],p)})}function m(t,o,e=null){return r=>{(e?n(e,c):[r.target]).forEach(n=>n.classList[t](o))}}function g(n){return(t,o=null)=>()=>{p[t][n](s(o,p[t],p)),b()}}y&&h({$parent:y.$data});return{set:(n,t)=>()=>{$(n,t),b()},toggle:n=>()=>{$(n,n=>!n),b()},setup(n,t){$(n,t)},on(n,t,o){const e=u(o);c.addEventListener(n,n=>{const o=t instanceof Node?t:n.target.closest(t);o&&c.contains(o)&&(n.$target=o,e(n))})},every(n,t){const o=u(t),c=1e3*n;let e=Date.now();const r=()=>{Date.now()-e<c||(e+=c,o()),f(r)};f(r)},delay:(n,t)=>()=>{const o=u(t),c=1e3*n;let e=Date.now();const r=()=>{Date.now()-e<c?f(r):o()};f(r)},addClass:(n,t=null)=>m("add",n,t),removeClass:(n,t=null)=>m("remove",n,t),toggleClass:(n,t=null)=>m("toggle",n,t),append:g("push"),prepend:g("unshift"),pop:g("pop"),shift:g("shift"),withEvent:n=>t=>n(t)(),render:b,classes:e,$data:p,$id:o,$root:c,$parent:y,$:(t,o=c)=>n(t,o),$$:(n,o=c)=>t(n,o),i:[]}}function h(n){const t=p(Math.random().toString(36).slice(2),n);return m.t.set(n,t),t}function y(n){for(const t of n.i)t.parentNode.removeChild(t)}function b(n){const t=[...new Set(n.map(n=>n.molecule))];for(const n of t)n.$root.parentNode&&n.$root.parentNode.removeChild(n.$root),y(n)}const $=Object.keys(p()).filter(n=>!n.startsWith("__"));function m(n,t){const o=Array.from(m.t.values()).find(t=>t.$id===n);t(o),o.render(!1)}async function g(n){const t=[];await a(n,n=>{c(n)&&t.push(n)});for(const n of t){const t=n.parentNode,o=m.t.get(t)||h(t);if(n.u=o,n.hasAttribute("src"))try{const t=n.getAttribute("src"),o=await fetch(t);if(o.status>=400)throw new Error("Unable to load Fluor script "+t);const c=await o.text();n.textContent=c}catch(t){n.textContent=`console.error("${t.message}")`}}const e=o();for(const n of t){const t=n.u,o=document.createElement("script"),c=`RunFluor("${t.$id}", async ({${$.join(",")}}) => {${n.textContent}})`;o.textContent=c,n.parentNode.removeChild(n),t.i.push(o),e.appendChild(o)}document.body.appendChild(e)}window.RunFluor=m,m.t=new Map,async function(){await new Promise(n=>{"loading"==document.readyState?document.addEventListener("DOMContentLoaded",n):n()}),await g(document.body)}();export default function v(n,o){m(h(t(n)).$id,o)}